
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Promise 和 Sync Await 异步编程 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="TaskQueue.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../CSS/">
            
                <a href="../CSS/">
            
                    
                    CSS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../CSS/repaint_reflow_relayout_restyle.html">
            
                <a href="../CSS/repaint_reflow_relayout_restyle.html">
            
                    
                    重绘重排
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    JS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.3.1" data-path="PromiseAndSyncAwaitProgramming.html">
            
                <a href="PromiseAndSyncAwaitProgramming.html">
            
                    
                    Promise 和 Sync Await 异步编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="TaskQueue.html">
            
                <a href="TaskQueue.html">
            
                    
                    任务队列-简述
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../HTML5/README.md">
            
                <span>
            
                    
                    HTML
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../HTML5/NewFeature.html">
            
                <a href="../HTML5/NewFeature.html">
            
                    
                    HTML5  新特性
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../Network/">
            
                <a href="../Network/">
            
                    
                    Network
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../Network/FromURLToLoad.html">
            
                <a href="../Network/FromURLToLoad.html">
            
                    
                    从输入 URL 到页面加载发生了什么
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="../Network/FromURLToLoad/DNSAnalysis.html">
            
                <a href="../Network/FromURLToLoad/DNSAnalysis.html">
            
                    
                    DNS 解析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="../Network/FromURLToLoad/TCPLink.html">
            
                <a href="../Network/FromURLToLoad/TCPLink.html">
            
                    
                    TCP 连接
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="../Network/FromURLToLoad/SendRequest.html">
            
                <a href="../Network/FromURLToLoad/SendRequest.html">
            
                    
                    发送 http 请求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="../Network/FromURLToLoad/HandleRequest.html">
            
                <a href="../Network/FromURLToLoad/HandleRequest.html">
            
                    
                    服务器处理请求并返回 HTTP 报文
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="../Network/FromURLToLoad/ClientAnalyze.html">
            
                <a href="../Network/FromURLToLoad/ClientAnalyze.html">
            
                    
                    浏览器渲染解析页面
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.6" data-path="../Network/FromURLToLoad/PerformanceOptimization.html">
            
                <a href="../Network/FromURLToLoad/PerformanceOptimization.html">
            
                    
                    前端性能优化
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.6.1" data-path="../Network/FromURLToLoad/CssOptimization.html">
            
                <a href="../Network/FromURLToLoad/CssOptimization.html">
            
                    
                    前端性能优化-CSS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.1.7" data-path="../Network/FromURLToLoad/BrowserThreadAndProcess.html">
            
                <a href="../Network/FromURLToLoad/BrowserThreadAndProcess.html">
            
                    
                    浏览器线程与进程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Handwriting Code
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../Vue/README.md">
            
                <span>
            
                    
                    Vue
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../VUE/VueAnalysis.html">
            
                <a href="../VUE/VueAnalysis.html">
            
                    
                    Vue.js 技术揭秘
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    React
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Vuex
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" >
            
                <span>
            
                    
                    Redux
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" >
            
                <span>
            
                    
                    Node
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    Webpack
            
                </span>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Promise 和 Sync Await 异步编程</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="&#x5373;&#x4F7F;&#x4F60;&#x662F;&#x4E94;&#x5C81;&#x7684;&#x5C0F;&#x5B69;&#xFF0C;&#x4E5F;&#x80FD;&#x628A;-asyncawait-&#x548C;-promises-&#x89E3;&#x91CA;&#x7ED9;&#x4F60;&#x542C;">&#x5373;&#x4F7F;&#x4F60;&#x662F;&#x4E94;&#x5C81;&#x7684;&#x5C0F;&#x5B69;&#xFF0C;&#x4E5F;&#x80FD;&#x628A; Async/Await &#x548C; Promises &#x89E3;&#x91CA;&#x7ED9;&#x4F60;&#x542C;</h1>
<p>Anyone who calls themselves a JavaScript developer has had to, at one point, work with either callback functions, Promises, or more recently, Async/Await syntax. If you&apos;ve been in the game long enough, then you&apos;ve probably seen the translation from the days where nested callbacks were the only way to do asynchronous JavaScript.</p>
<p>When I first learning and writing JavaScript, there were already a billion guides and tutorials out there explaining how to use them. Yet, many of them were just explaining how to convert between callbacks to Promises, or Promises to Async/Await. Admittedly, for many, that is probably more than enough for them to get along and write code.</p>
<h2 id="what-dose-asynchronous-mean">What dose &quot;Asynchronous&quot; mean</h2>
<p>Whilst there&apos;s still the same number of things to do, you can hopefully see how this would be much faster and more efficient. This is exactly the same core concept as asynchronous programming: <strong>you never want to sit around purely waiting for something whilst there are other things you can spend your effort on.</strong></p>
<p>And we all know that in programming, <strong>waiting</strong> happens pretty damn often -- whether it be waiting for an HTTP Response from a server, filesystem I/O, etc. But your CPU&apos;s execution cycles are precious and should always be spend activity doing something, and not waiting around: hence,
<strong>Asynchronous Programming</strong>.</p>
<p>As for the asynchronous functions, first I&apos;ll quickly explain how JavaScript&apos;s type system handles asynchronicity: basically, all results (including void ones) from asynchronous operations must be wrapped in a Promise type.</p>
<p>In order to have a function return a Promise, you can either</p>
<ul>
<li>Explicitly return a Promise i.e.<strong> return new Promise(......)</strong>;</li>
<li>Add async to the function signature</li>
<li><em>or both of the above.</em></li>
</ul>
<p>if you don&apos;t declare a function as async, then by default JavaScript takes that to mean it is a synchronous function -- and synchronous means no waiting! (this also means you can&apos;t use await at the top level script outside of a function at all).</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chopCarrots</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">10000</span>; j++) {
      k = <span class="hljs-built_in">Math</span>.pow(k, i * j) / k
    }
  }
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Done chopping carrots!&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">chopOnions</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">let</span> k = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">10000</span>; i++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j=<span class="hljs-number">0</span>; j&lt;<span class="hljs-number">10000</span>; j++) {
      k = <span class="hljs-built_in">Math</span>.pow(k, i * j) / k
    }
  }
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Done chopping onions!&quot;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addOnions</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Add Onions to pot!&apos;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addCarrots</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Add Carrots to pot!&apos;</span>);
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">letPotKeepBoiling</span>(<span class="hljs-params">time</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve) =&gt; setTimeout(() =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Pot has boiled for &quot;</span>, time, <span class="hljs-string">&quot; minutes&quot;</span>);
    resolve();
  }, time * <span class="hljs-number">100</span>));
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boilPot</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>((resolve) =&gt; setTimeout(() =&gt; {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Done boiling pot!&quot;</span>);
    resolve();
  }, <span class="hljs-number">5000</span>));
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeSoup</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> pot = boilPot();
  chopCarrots();
  chopOnions();
  <span class="hljs-keyword">await</span> pot;
  addCarrots();
  <span class="hljs-keyword">await</span> letPotKeepBoiling(<span class="hljs-number">5</span>);
  addOnions();
  <span class="hljs-keyword">await</span> letPotKeepBoiling(<span class="hljs-number">10</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Your vegetable soup is ready!&quot;</span>);
}

makeSoup();
</code></pre>
<h2 id="what-about-explicit-promises">What about explicit Promises</h2>
<p>Keep in mind, <strong>the async/await methods are based on promises themselves and hence the two methods are fully compatible.</strong></p>
<p>Explicit Promise are, in my opinion, the half-way between using old-style callbacks and the new sexy async/await syntax. Alternatively, you can also think of the sexy async/await syntax as nothing more than implicit Promise. After all, async/await came after Promises, which itself came after callbacks.</p>
<h2 id="async-function-vs-a-function-that-returns-a-promise">Async function vs. a function that returns a Promise</h2>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">const</span> someProp = obj.someProp
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(someProp)
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">asyncFn</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">const</span> someProp = obj.someProp
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(someProp)
}

asyncFn().catch(err =&gt; <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&apos;Catched&apos;</span>)) <span class="hljs-comment">// =&gt; &apos;Catched&apos;</span>
fn().catch(err =&gt; <span class="hljs-built_in">console</span>.error(<span class="hljs-string">&apos;Catched&apos;</span>)) <span class="hljs-comment">// =&gt; TypeError: Cannot read property &apos;someProp&apos; of undefined</span>
</code></pre>
<p>As you can see, both of the functions above have the same body in which we try access a property of an argument that is undefined in both cases. the only difference between the two functions is that asyncFn is declared with the async keyword.</p>
<p>This means that JavaScript will make sure that the asyncFn will return with a Promise (either resolved or rejected) even if an error occured in it, in our case calling our .catch() block.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: JS">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="TaskQueue.html" class="navigation navigation-next " aria-label="Next page: 任务队列-简述">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Promise 和 Sync Await 异步编程","level":"1.3.1","depth":2,"next":{"title":"任务队列-简述","level":"1.3.2","depth":2,"path":"JS/TaskQueue.md","ref":"JS/TaskQueue.md","articles":[]},"previous":{"title":"JS","level":"1.3","depth":1,"path":"JS/README.md","ref":"JS/README.md","articles":[{"title":"Promise 和 Sync Await 异步编程","level":"1.3.1","depth":2,"path":"JS/PromiseAndSyncAwaitProgramming.md","ref":"JS/PromiseAndSyncAwaitProgramming.md","articles":[]},{"title":"任务队列-简述","level":"1.3.2","depth":2,"path":"JS/TaskQueue.md","ref":"JS/TaskQueue.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"JS/PromiseAndSyncAwaitProgramming.md","mtime":"2019-11-17T05:00:07.009Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-17T05:02:21.067Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

